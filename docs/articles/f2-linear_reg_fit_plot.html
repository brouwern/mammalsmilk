<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>f2) Running and plotting Linear Regression • mammalsmilk</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="f2) Running and plotting Linear Regression">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mammalsmilk</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a-introduction.html">a) Introduction to the mammals' milk case study</a>
    </li>
    <li>
      <a href="../articles/b1-data_access.html">b) Accessing mammalsmilk data</a>
    </li>
    <li>
      <a href="../articles/b2-data_cleaning.html">b) Data cleaning</a>
    </li>
    <li>
      <a href="../articles/c-data_subsetting.html">C) Data subsetting using dplyr</a>
    </li>
    <li>
      <a href="../articles/d-data_exploration.html">d) Data Exploration for Regression Analyses</a>
    </li>
    <li>
      <a href="../articles/e-PCA_data_vis.html">e) Data visualization &amp; exploration with PCA</a>
    </li>
    <li>
      <a href="../articles/f1-linear_reg_notes.html">f1) Linear regression notes</a>
    </li>
    <li>
      <a href="../articles/f2-linear_reg_fit_plot.html">f2) Running and plotting Linear Regression </a>
    </li>
    <li>
      <a href="../articles/f3-linear_reg_model_fit.html">f3) Linear regression as model fitting</a>
    </li>
    <li>
      <a href="../articles/g-linear_reg_diagnostics.html">g) Regression diagnostics &amp; Residual Analysis</a>
    </li>
    <li>
      <a href="../articles/r-regression_references.html">r) Regression references</a>
    </li>
    <li>
      <a href="../articles/y-creating_a_package.html">w) Creating this package</a>
    </li>
    <li>
      <a href="../articles/z-build_and_rebuild_package.html">Building and rebuilding vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>f2) Running and plotting Linear Regression</h1>
                        <h4 class="author">Nathan Brouwer | <a href="mailto:brouwern@gmail.com">brouwern@gmail.com</a> | <span class="citation">@lowbrowR</span>
</h4>
            
            <h4 class="date">2018-11-27</h4>
      
      
      <div class="hidden name"><code>f2-linear_reg_fit_plot.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This walk through introduces how to run a basic linear regression model and plot the output. It demonstrates different ways to plot the output, including</p>
<ul>
<li>ggplot</li>
<li>ggpubr::ggscatter</li>
<li>The gg_lm_plot() function in the mammalsmilk package</li>
</ul>
<p>In this tutorial, we will examine the relationship between the fat content of the milk of different species as a function of the mass of the mother. We will focus on primate species and their relatively close relatives (rabbits and rodents - yes, they are our relatives).</p>
</div>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<div id="load-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load data</h3>
<p>Install the mammals milk package if needed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install_github("brouwern/mammalsmilk")</span></code></pre></div>
<p>You can then load the package with library()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mammalsmilk)</code></pre></div>
<p>The example data is milk_primates</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"milk_primates"</span>)</code></pre></div>
</div>
<div id="load-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#load-libraries" class="anchor"></a>Load libraries</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#library(ggplot2)</span>
<span class="kw">library</span>(cowplot)
<span class="kw">library</span>(arm)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(ggpubr)</code></pre></div>
</div>
</div>
<div id="basic-regression-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-regression-in-r" class="anchor"></a>Basic regression in R</h2>
<p>Linear regression is done in R with the lm() function, which stands for “linear model”. Most “statistical tests are or can be formulated as linear models; t-tests, ANOVA, ANCOVA, linear regression, and multiple linear regression are all linear models</p>
<p>Some common methods can’t be fit directly as a linear model, like Welch’s t-test, which corrects for unequal variance. However, a very similar approach can be implemented using the function gls() in the nlme package. Standard linear regression is fit using least squares methods, and “gls” stands for “generalized least squares” and makes it possible to relax many of the standard assumptions of classic statistical tests, such as constant variance and independence of residuals.</p>
<p>An extension of the lm() function is glm(), which stands for “general linear model” or “generalized linear model.” Linear models work with numeric data and assumes that residuals are normally distributed. GLMs allow you to work binomial, count, and other forms of data that have non-normal residuals.</p>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h3>
<p>The data has been cleaned in previous tutorials. One thing that will make modeling these data is to transform the predictor variable. This is because the mass of animals varies so much.</p>
<p>If we look at the raw data its pretty ugly</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggscatter</span>(<span class="dt">data =</span> milk_primates,
         <span class="dt">y =</span> <span class="st">"fat"</span>,
         <span class="dt">x =</span> <span class="st">"mass.fem"</span>)</code></pre></div>
<p><img src="f2-linear_reg_fit_plot_files/figure-html/first.ggscagtter.chunk-1.png" width="700"></p>
<p>This is because the dataset contains Gorillas, which weigh almost 100,000 grams. The next largest animals is a baboon, then a beaver (humans are absent from the dataset for some reason).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#determine order</span>
i. &lt;-<span class="st"> </span><span class="kw">order</span>(milk_primates<span class="op">$</span>mass.fem,
            <span class="dt">decreasing =</span> T)

<span class="co">#display largest 3 spp</span>
milk_primates<span class="op">$</span>spp[i.][<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre></div>
<pre><code>## [1] Gorilla beringei beringei Papio papio              
## [3] Castor fiber             
## 42 Levels: Acomys cahirinus Aloutta palliata ... Varecia variegata</code></pre>
<p>Log transformation makes things more linear.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#this could be done with dplyr::mutate() too</span>
milk_primates<span class="op">$</span>mass.fem.log &lt;-<span class="st"> </span><span class="kw">log</span>(milk_primates<span class="op">$</span>mass.fem)</code></pre></div>
<p>Now check out the plot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggscatter</span>(<span class="dt">data =</span> milk_primates,
         <span class="dt">y =</span> <span class="st">"fat"</span>,
         <span class="dt">x =</span> <span class="st">"mass.fem.log"</span>)</code></pre></div>
<p><img src="f2-linear_reg_fit_plot_files/figure-html/second.ggscatter.chunk-1.png" width="700"></p>
</div>
<div id="building-a-regression-model" class="section level3">
<h3 class="hasAnchor">
<a href="#building-a-regression-model" class="anchor"></a>Building a regression model</h3>
<p>Let’s fit a simple linear regression model. This will have the form we are familiar with from geometry class of</p>
<blockquote>
<p>y = m*x + b</p>
</blockquote>
<p>Where b is the y intercept and m is the slope.</p>
<p>In stats, we typically change the order</p>
<blockquote>
<p>y = b + m*x</p>
</blockquote>
<p>Additionally, we call b “Beta 0” and m “Beta 1”</p>
<blockquote>
<p>y = B0 + B1*x</p>
</blockquote>
<p>To make life hard, R will call B0 “(Intercept)”.</p>
<p>For our particularly situation, we have the model</p>
<blockquote>
<p>fat = B0 + B1*mass.fem.log</p>
</blockquote>
<p>and we want R to estimate the intercept B0 and the slope B1.</p>
<p>We therefore tell R</p>
<blockquote>
<p>fat ~ 1 + mass.fem.log</p>
</blockquote>
<p>Where the 1 represents the intercept. In most cases we drop it and just write</p>
<blockquote>
<p>fat ~ mass.fem.log</p>
</blockquote>
<p>The model is run like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lm.mass &lt;-<span class="st"> </span><span class="kw">lm</span>(fat <span class="op">~</span><span class="st"> </span>mass.fem.log,
             <span class="dt">data =</span> milk_primates)</code></pre></div>
</div>
</div>
<div id="model-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#model-summary" class="anchor"></a>Model summary</h2>
<ul>
<li>Look at model output with summary()</li>
<li>We can also load the broom package and use the tidy() command to get a more compact output</li>
<li>A function is arm::display</li>
<li>we can get just the coefficients/slopes with coef()</li>
</ul>
<div id="standard-summary" class="section level3">
<h3 class="hasAnchor">
<a href="#standard-summary" class="anchor"></a>Standard summary</h3>
<p>The standard summary command gives you lots of info</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(lm.mass)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = fat ~ mass.fem.log, data = milk_primates)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -8.339 -4.177 -1.053  1.222 15.743 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   20.5150     3.2492   6.314 1.71e-07 ***
## mass.fem.log  -1.7517     0.4574  -3.830 0.000443 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 5.961 on 40 degrees of freedom
## Multiple R-squared:  0.2683, Adjusted R-squared:   0.25 
## F-statistic: 14.67 on 1 and 40 DF,  p-value: 0.0004425</code></pre>
<p>The coef() command just gives you the intercept (B0) and the slope (B1), though it doesn’t label them that well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(lm.mass)</code></pre></div>
<pre><code>##  (Intercept) mass.fem.log 
##    20.514997    -1.751746</code></pre>
</div>
<div id="broomtidy" class="section level3">
<h3 class="hasAnchor">
<a href="#broomtidy" class="anchor"></a>broom::tidy</h3>
<p>A cleaner output can be created with the tidy() function in the broom package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(lm.mass)</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term         estimate std.error statistic     p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 (Intercept)     20.5      3.25       6.31 0.000000171
## 2 mass.fem.log    -1.75     0.457     -3.83 0.000443</code></pre>
</div>
<div id="armdisplay" class="section level3">
<h3 class="hasAnchor">
<a href="#armdisplay" class="anchor"></a>arm::display</h3>
<p>I also like arm::display()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arm<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/arm/topics/display">display</a></span>(lm.mass)</code></pre></div>
<pre><code>## lm(formula = fat ~ mass.fem.log, data = milk_primates)
##              coef.est coef.se
## (Intercept)  20.51     3.25  
## mass.fem.log -1.75     0.46  
## ---
## n = 42, k = 2
## residual sd = 5.96, R-Squared = 0.27</code></pre>
</div>
</div>
<div id="plot-model" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-model" class="anchor"></a>Plot model</h2>
<p>For simple linear regression with a single predictor variable we can plot things easily using the ggscatter() function from ggpubr with ‘add = “reg.line”’ and ‘conf.int = TRUE’</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggscatter</span>(<span class="dt">data =</span> milk_primates,
          <span class="dt">y =</span> <span class="st">"fat"</span>,
          <span class="dt">x =</span> <span class="st">"mass.fem.log"</span>,
          <span class="dt">add =</span> <span class="st">"reg.line"</span>,
          <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="f2-linear_reg_fit_plot_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Similar functionality with more options can be had using basic ggplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> milk_primates,
          <span class="kw">aes</span>(<span class="dt">y =</span> fat,
              <span class="dt">x =</span> mass.fem.log)) <span class="op">+</span>
<span class="st">         </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">         </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm)</code></pre></div>
<p>The mammalsmilk package also includes a function, gg_lm_plot(), which is fairly compact and adds some annotation. It can show either summary stats</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gg_lm_plot.html">gg_lm_plot</a></span>(lm.mass,
           <span class="dt">xlab. =</span> <span class="st">"log(female mass)"</span>,
           <span class="dt">ylab. =</span> <span class="st">"Fat %"</span>,
           <span class="dt">annotate. =</span> <span class="st">"summary"</span>)</code></pre></div>
<p><img src="f2-linear_reg_fit_plot_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Or the equation for the model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gg_lm_plot.html">gg_lm_plot</a></span>(lm.mass,
           <span class="dt">xlab. =</span> <span class="st">"log(female mass)"</span>,
           <span class="dt">ylab. =</span> <span class="st">"Fat %"</span>,
           <span class="dt">annotate. =</span> <span class="st">"equation"</span>)</code></pre></div>
<p><img src="f2-linear_reg_fit_plot_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#basic-regression-in-r">Basic regression in R</a></li>
      <li><a href="#model-summary">Model summary</a></li>
      <li><a href="#plot-model">Plot model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
